<!DOCTYPE html>
<html lang="pt-BR">
<script src="functions.js"></script>

<head>

   <!-- Para resetar CSS do browser-->
   <link rel="stylesheet" href="reset.css">
   <!-- Noosso CSS -->
   <link rel="stylesheet" href="styles.css">

   <meta charset="UTF-8">
   <title>Gráfico de Candles OHLC</title>
   <style>
      body {
         display: flex;
         justify-content: center;
         align-items: center;
         height: 100vh;
         background: #f4f4f4;
      }

      svg {
         border: 1px solid #333;
         background: white;
      }
   </style>
</head>

<body>


   <div class="container">
      <script>tiker = prompt("Qual Ticker você deseja simular? Exemplo: AAPL, MSFT, TSLA");
         document.write("<h2>Simulação de gráfico para o Ticker: " + tiker + " </h2>");
      </script>
      <div class="topo"> Gerador de pseudo gráfico de ação de bolsa de valores
         <a href="">
            <button class="button-recarregar" type="button">Gerar novo Gráfico!</button>

         </a>
      </div>

      <div class="infos-horizontal">
         <div class="grafico-container">
            <svg id="grafico" width="800" height="400"></svg>
            <div class="preço">
               <div>Preço R$ 46.00</div>
               <div>Preço R$ 43.00</div>
               <div>Preço R$ 40.00</div>
               <div>Preço R$ 37.00</div>
               <div>Preço R$ 34.00</div>
               <div>Preço R$ 31.00</div>
               <div>Preço R$ 28.00</div>
               <div>Preço R$ 25.00</div>
            </div>
         </div>
         <div class="estatistica-lateral">
            Procentagem DIA % <br>
            média móvel 21 SMA <br>
            Máxima DIA <br>
            Mínima DIA <br>
         </div>
      </div>

      <script>

         //let precoRandomico = 0;
         let tamanho = 29;
         let candles = [];
         let matrizVolatilidade = []
         // abertura, fechamento, minima, maxima,
         //tamanho = prompt("Qual a quantidade de candles que você deseja gerar? Exemplo: 29");
         var vies = "nonono";

         vies = defineLadoDoViesInicial(vies);


         //precoRandomico = geraValorAleatorio();
         candles = geraCandleAleatorio(tamanho, candles);

         printaArrayCandle(candles);

         calculoPorcentagemDoDia(candles);
         printaMaximaDoDia(candles, tamanho);
         printaMinimaDoDia(candles, tamanho);
         printaMediaDoPreco(candles, tamanho);

         matrizVolatilidade = carregaVolatilidadePorCandle(candles, tamanho);
         printaVolatilidadePorCandle(matrizVolatilidade, tamanho);
         // Exemplo de dados OHLC
         // Achei o minimo e máximo do range do gráfico
         const dados = [];

         for (let i = 0; i < 29; i++) {
            dados.push({
               open: candles[i][0],   // valor de exemplo variando
               high: candles[i][3],     // valor de exemplo variando
               low: candles[i][2],      // valor de exemplo variando
               close: candles[i][1]     // valor de exemplo variando
            });
         }




         // =============================================================
         // Criação do gráfico de candles
         // Seleciona o SVG e define dimensões

         const svg = document.getElementById("grafico");
         const largura = svg.clientWidth;
         const altura = svg.clientHeight;
         const espacamento = largura / (dados.length + 1);

         // Escala simples (ajusta valores ao tamanho do gráfico)
         const max = Math.max(...dados.map(d => d.high + 1));
         const min = Math.min(...dados.map(d => d.low + -1));
         const escalaY = valor => altura - ((valor - min) / (max - min)) * (altura - 20);

         dados.forEach((candle, i) => {
            const x = (i + 1) * espacamento;

            const yOpen = escalaY(candle.open);
            const yHigh = escalaY(candle.high);
            const yLow = escalaY(candle.low);
            const yClose = escalaY(candle.close);


            const cor = candle.close > candle.open ? "green" : "red";

            // Linha vertical (high → low)
            const linha = document.createElementNS("http://www.w3.org/2000/svg", "line");
            linha.setAttribute("x1", x);
            linha.setAttribute("y1", yHigh);
            linha.setAttribute("x2", x);
            linha.setAttribute("y2", yLow);
            linha.setAttribute("stroke", "black");
            svg.appendChild(linha);

            // Retângulo (open → close)
            const rect = document.createElementNS("http://www.w3.org/2000/svg", "rect");
            rect.setAttribute("x", x - 10);
            rect.setAttribute("y", Math.min(yOpen, yClose));
            rect.setAttribute("width", 20);
            rect.setAttribute("height", Math.abs(yClose - yOpen));
            rect.setAttribute("fill", cor);
            svg.appendChild(rect);
         });
      </script>


   </div>


</body>

</html>